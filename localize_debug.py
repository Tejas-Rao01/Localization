#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Feb 27 18:58:04 2023

@author: shreyash
"""
import robot_params 
import math
import numpy as np
import localization_constants
import matplotlib.pyplot as plt
import wall_ekf
import wall_detection
import wall_localization
lidar_data = [-1.0, 12148.6904296875, 1.6418230533599854, -1.5330474376678467, 2.0655176639556885, 721.0, 3.1415927410125732, -1.5707963705062866, 0.004363323096185923, 6.485702991485596, 6.501067638397217, 6.516628265380859, 6.532390117645264, 6.548351764678955, 6.56451940536499, 6.580889701843262, 6.597470283508301, 6.614260673522949, 6.631260395050049, 6.648477077484131, 6.665911674499512, 6.683562278747559, 6.701436996459961, 6.719535827636719, 6.737858772277832, 6.756413459777832, 6.775199890136719, 6.794219970703125, 6.813477039337158, 6.832974910736084, 6.852715492248535, 6.8727006912231445, 6.8929362297058105, 6.913420677185059, 6.883471488952637, 6.840263366699219, 6.797723293304443, 6.755834102630615, 6.7145867347717285, 6.673965930938721, 6.633960723876953, 6.594554901123047, 6.555739402770996, 6.517500877380371, 6.479828357696533, 6.442712783813477, 6.406139850616455, 6.370100021362305, 6.3345842361450195, 6.299581527709961, 6.265081405639648, 6.231075286865234, 6.197555065155029, 6.1645097732543945, 6.131929397583008, 6.099807262420654, 6.068137168884277, 6.036907196044922, 6.006110191345215, 5.975739002227783, 5.945785999298096, 5.91624641418457, 5.88710880279541, 5.858365535736084, 5.830013751983643, 5.802045822143555, 5.774454593658447, 5.747231483459473, 5.720373630523682, 5.693873882293701, 5.667725563049316, 5.641922473907471, 5.616459369659424, 5.591331958770752, 5.566535949707031, 5.5420613288879395, 5.5179057121276855, 5.494065284729004, 5.470531940460205, 5.4472503662109375, 5.424322128295898, 5.401688098907471, 5.379342079162598, 5.357283592224121, 5.335506916046143, 5.3140058517456055, 5.292778968811035, 5.271820545196533, 5.251126766204834, 5.23069429397583, 5.210519790649414, 5.190597057342529, 5.170925140380859, 5.151499271392822, 5.1323161125183105, 5.113372802734375, 5.09466552734375, 5.076189994812012, 5.057944297790527, 5.039925575256348, 5.022128582000732, 5.004552841186523, 4.987194538116455, 4.97005033493042, 4.953117370605469, 4.936393737792969, 4.919875144958496, 4.903559684753418, 4.887444019317627, 4.8715291023254395, 4.855807781219482, 4.840278625488281, 4.824941635131836, 4.809792518615723, 4.794829845428467, 4.780049800872803, 4.765449523925781, 4.751030921936035, 4.736788749694824, 4.722720623016357, 4.70882511138916, 4.6951003074646, 4.681545257568359, 4.668155670166016, 4.654930591583252, 4.641869068145752, 4.628969192504883, 4.6162261962890625, 4.603641510009766, 4.591214179992676, 4.578939914703369, 4.566816329956055, 4.554844856262207, 4.543022155761719, 4.531345844268799, 4.519815921783447, 4.508430480957031, 4.497185707092285, 4.486084461212158, 4.475121021270752, 4.464296817779541, 4.453608989715576, 4.443057060241699, 4.432639122009277, 4.422354698181152, 4.412201404571533, 4.402176380157471, 4.392282009124756, 4.382514476776123, 4.372873306274414, 4.3633575439453125, 4.353965759277344, 4.344698429107666, 4.335551738739014, 4.326502799987793, 4.317595481872559, 4.308807849884033, 4.300137519836426, 4.2915825843811035, 4.283143997192383, 4.274817943572998, 4.266607761383057, 4.25850772857666, 4.250520706176758, 4.242644309997559, 4.234875679016113, 4.227217197418213, 4.219666957855225, 4.212223529815674, 4.204885005950928, 4.197652816772461, 4.190524101257324, 4.18350076675415, 4.176579475402832, 4.169760227203369, 4.163041591644287, 4.156424522399902, 4.149906635284424, 4.143488883972168, 4.137167930603027, 4.130947113037109, 4.12482213973999, 4.11879301071167, 4.112861156463623, 4.1070237159729, 4.101280689239502, 4.095631122589111, 4.090075969696045, 4.084612846374512, 4.079241752624512, 4.073962688446045, 4.068774223327637, 4.063676357269287, 4.05866813659668, 4.053749084472656, 4.048920154571533, 4.0441789627075195, 4.039525985717773, 4.034959316253662, 4.03048038482666, 4.026087760925293, 4.021782398223877, 4.0175604820251465, 4.013425350189209, 4.009374618530273, 4.005407333374023, 4.001525402069092, 3.9977264404296875, 3.9940104484558105, 3.990377902984619, 3.9868276119232178, 3.9833593368530273, 3.9799723625183105, 3.976666212081909, 3.973442316055298, 3.970299005508423, 3.967235565185547, 3.9642529487609863, 3.961350202560425, 3.9585249423980713, 3.9557807445526123, 3.9531161785125732, 3.950530767440796, 3.9480221271514893, 3.9455912113189697, 3.943239688873291, 3.9409661293029785, 3.938770055770874, 3.9366512298583984, 3.9346089363098145, 3.932643413543701, 3.930755853652954, 3.9289438724517822, 3.927208423614502, 3.9255502223968506, 3.923967123031616, 3.922459840774536, 3.9210290908813477, 3.919672966003418, 3.9183926582336426, 3.9171879291534424, 3.9160590171813965, 3.9150049686431885, 3.914025068283081, 3.913121461868286, 3.912292003631592, 3.91153883934021, 3.9108572006225586, 3.910252571105957, 3.9097225666046143, 3.9092657566070557, 3.9088845252990723, 3.908578634262085, 3.9083452224731445, 3.9081878662109375, 3.9081034660339355, 3.9080944061279297, 3.9081594944000244, 3.9083003997802734, 3.908513307571411, 3.908802032470703, 3.9091646671295166, 3.909602403640747, 3.9101145267486572, 3.910677433013916, 3.91133975982666, 3.912074565887451, 3.912885904312134, 3.913771152496338, 3.914731740951538, 3.915767192840576, 3.9168787002563477, 3.9180638790130615, 3.919325828552246, 3.9206628799438477, 3.922074317932129, 3.923563003540039, 3.9251270294189453, 3.926767587661743, 3.928483009338379, 3.9302759170532227, 3.932145118713379, 3.934091806411743, 3.936114549636841, 3.938213586807251, 3.9403913021087646, 3.9426462650299072, 3.9449777603149414, 3.9473893642425537, 3.9498775005340576, 3.952444076538086, 3.955089807510376, 3.9578144550323486, 3.960618734359741, 3.9635021686553955, 3.9664652347564697, 3.969508409500122, 3.9726321697235107, 3.9758358001708984, 3.9791219234466553, 3.982487916946411, 3.985935688018799, 3.989466428756714, 3.9930789470672607, 3.996774196624756, 4.000552177429199, 4.004413604736328, 4.008360862731934, 4.012390613555908, 4.016504287719727, 4.020704746246338, 4.024989128112793, 4.029360771179199, 4.033817291259766, 4.038361549377441, 4.042993545532227, 4.047712802886963, 4.052520275115967, 4.057416915893555, 4.062403202056885, 4.067478656768799, 4.072644233703613, 4.0779008865356445, 4.083249092102051, 4.088690280914307, 4.094222068786621, 4.099847793579102, 4.105567455291748, 4.111382007598877, 4.117290496826172, 4.123295307159424, 4.129395961761475, 4.135593891143799, 4.1418890953063965, 4.148283004760742, 4.154776096343994, 4.161368370056152, 4.16806173324585, 4.174854755401611, 4.181751251220703, 4.18874979019165, 4.195852279663086, 4.203059196472168, 4.210370063781738, 4.21778678894043, 4.225310802459717, 4.232943058013916, 4.2406840324401855, 4.248532772064209, 4.256494045257568, 4.264565467834473, 4.2727484703063965, 4.281045436859131, 4.289455413818359, 4.297980785369873, 4.306623935699463, 4.315382957458496, 4.324259281158447, 4.333254814147949, 4.342372417449951, 4.351611137390137, 4.360971450805664, 4.370456695556641, 4.38006591796875, 4.389801979064941, 4.399664402008057, 4.409656524658203, 4.419777870178223, 4.430030345916748, 4.440415859222412, 4.450933456420898, 4.461590766906738, 4.472380638122559, 4.4833083152771, 4.494376182556152, 4.505584716796875, 4.5169358253479, 4.5284295082092285, 4.540068626403809, 4.551855564117432, 4.563791275024414, 4.5758748054504395, 4.588111877441406, 4.600501537322998, 4.613047122955322, 4.6257500648498535, 4.638610363006592, 4.651630878448486, 4.664815425872803, 4.678163051605225, 4.691678524017334, 4.705360412597656, 4.719213008880615, 4.733238220214844, 4.747437000274658, 4.761812210083008, 4.776366233825684, 4.791100978851318, 4.806017875671387, 4.821122169494629, 4.83641242980957, 4.851891994476318, 4.867566108703613, 4.883432388305664, 4.899498462677002, 4.915762424468994, 4.932230472564697, 4.9489030838012695, 4.965784072875977, 4.982876777648926, 5.000181198120117, 5.017702102661133, 5.035444259643555, 5.053407192230225, 5.071595668792725, 5.090014457702637, 5.108664512634277, 5.127548694610596, 5.14667272567749, 5.166036605834961, 5.185647487640381, 5.205506324768066, 5.225619316101074, 5.245985507965088, 5.2666144371032715, 5.2875075340271, 5.308668613433838, 5.330101013183594, 5.351808547973633, 5.373796463012695, 5.396068572998047, 5.418630599975586, 5.441486358642578, 5.464639663696289, 5.488096237182617, 5.5118608474731445, 5.535937309265137, 5.560330867767334, 5.585048198699951, 5.563949108123779, 5.540529251098633, 5.517411231994629, 5.494589328765869, 5.472060203552246, 5.44981575012207, 5.4278564453125, 5.40617561340332, 5.384768962860107, 5.363633632659912, 5.342763900756836, 5.322157859802246, 5.301809310913086, 5.281717300415039, 5.261875152587891, 5.242283821105957, 5.222934722900391, 5.203826904296875, 5.1849565505981445, 5.166320323944092, 5.147916793823242, 5.1297407150268555, 5.111789226531982, 5.094059467315674, 5.0765485763549805, 5.059253215789795, 5.042171478271484, 5.025299549102783, 5.008635997772217, 4.992177486419678, 4.975921630859375, 4.959863662719727, 4.944003105163574, 4.928338050842285, 4.912863731384277, 4.8975830078125, 4.882485389709473, 4.8675737380981445, 4.852847099304199, 4.83829927444458, 4.8239312171936035, 4.809739589691162, 4.795722007751465, 4.781875133514404, 4.768199443817139, 4.754693031311035, 4.741352558135986, 4.728175640106201, 4.71516227722168, 4.7023091316223145, 4.689615249633789, 4.677077293395996, 4.6646952629089355, 4.652466773986816, 4.640392303466797, 4.6284661293029785, 4.616689682006836, 4.605061054229736, 4.593576431274414, 4.582237243652344, 4.571040153503418, 4.5599846839904785, 4.549069404602051, 4.5382914543151855, 4.527649879455566, 4.517145156860352, 4.506774425506592, 4.4965362548828125, 4.4864301681518555, 4.476454257965088, 4.466607570648193, 4.456887722015381, 4.447295665740967, 4.43782901763916, 4.42848539352417, 4.419266223907471, 4.410170078277588, 4.401193618774414, 4.392337322235107, 4.383599758148193, 4.374980926513672, 4.366477966308594, 4.358090877532959, 4.349819183349609, 4.341660022735596, 4.333615779876709, 4.325683116912842, 4.317859172821045, 4.310146808624268, 4.302544116973877, 4.295050621032715, 4.287662982940674, 4.28038215637207, 4.2732086181640625, 4.266139507293701, 4.259174823760986, 4.252313613891602, 4.2455549240112305, 4.238897800445557, 4.232341766357422, 4.225886821746826, 4.219532012939453, 4.213277339935303, 4.207119941711426, 4.201060771942139, 4.19509744644165, 4.189232349395752, 4.183463096618652, 4.177788734436035, 4.172208309173584, 4.166722774505615, 4.161330699920654, 4.156031131744385, 4.150825500488281, 4.145709991455078, 4.140686511993408, 4.135753631591797, 4.130910873413086, 4.126158714294434, 4.121495246887207, 4.1169209480285645, 4.112434387207031, 4.108035564422607, 4.103725433349609, 4.099501609802246, 4.095364570617676, 4.091312408447266, 4.087347030639648, 4.083467960357666, 4.079672813415527, 4.075962543487549, 4.072335720062256, 4.068793296813965, 4.065334796905518, 4.0619587898254395, 4.058665752410889, 4.055455207824707, 4.052326679229736, 4.049280166625977, 4.046315670013428, 4.043430805206299, 4.040628910064697, 4.037907600402832, 4.0352654457092285, 4.032703876495361, 4.0302228927612305, 4.027820587158203, 4.025498867034912, 4.023255348205566, 4.021090984344482, 4.01900577545166, 4.016999244689941, 4.015071392059326, 4.013221740722656, 4.011449337005615, 4.009755611419678, 4.008139133453369, 4.006599426269531, 4.005138397216797, 4.003754615783691, 4.002447128295898, 4.001217365264893, 4.000062942504883, 3.9989876747131348, 3.997988224029541, 3.9970645904541016, 3.996217966079712, 3.9954473972320557, 3.9947540760040283, 3.994135856628418, 3.9935946464538574, 3.993129253387451, 3.9927399158477783, 3.992427110671997, 3.992189645767212, 3.9920291900634766, 3.9919443130493164, 3.9919352531433105, 3.9920027256011963, 3.9921457767486572, 3.9923641681671143, 3.992659568786621, 3.9930310249328613, 3.993478298187256, 3.994002103805542, 3.994601011276245, 3.9952776432037354, 3.9960296154022217, 3.9968578815460205, 3.997762680053711, 3.998743772506714, 3.999802589416504, 4.000937461853027, 4.0021491050720215, 4.0034379959106445, 4.004803657531738, 4.0062479972839355, 4.007768630981445, 4.009366035461426, 4.011041641235352, 4.0127949714660645, 4.014626502990723, 4.016536712646484, 4.018524169921875, 4.020590782165527, 4.0227370262146, 4.024960994720459, 4.0272650718688965, 4.029648303985596, 4.032110214233398, 4.034653186798096, 4.037275314331055, 4.039979457855225, 4.042761325836182, 4.045626163482666, 4.048572540283203, 4.051599502563477, 4.054708003997803, 4.057899475097656, 4.061172962188721, 4.0645294189453125, 4.067967414855957, 4.071491241455078, 4.07509708404541, 4.078787326812744, 4.0825629234313965, 4.086422920227051, 4.090368270874023, 4.0943989753723145, 4.098515510559082, 4.102718830108643, 4.107009410858154, 4.111386775970459, 4.115851879119873, 4.120405673980713, 4.125048637390137, 4.129779815673828, 4.134600639343262, 4.139512062072754, 4.144514560699463, 4.1496076583862305, 4.154791831970215, 4.160069942474365, 4.165440082550049, 4.170903205871582, 4.176461219787598, 4.182113170623779, 4.187860488891602, 4.1937031745910645, 4.199642181396484, 4.205678462982178, 4.2118120193481445, 4.218044757843018, 4.224376201629639, 4.230807304382324, 4.237338542938232, 4.243971824645996, 4.250706195831299, 4.257542610168457, 4.264483451843262, 4.271528720855713, 4.278677940368652, 4.285932540893555, 4.2932939529418945, 4.300762176513672, 4.308340549468994, 4.31602668762207, 4.32382345199585, 4.331730842590332, 4.339747905731201, 4.3478803634643555, 4.356126308441162, 4.364485263824463, 4.372959613800049, 4.381552219390869, 4.390262126922607, 4.399089336395264, 4.408036231994629, 4.417105197906494, 4.426295757293701, 4.435609817504883, 4.4450459480285645, 4.45460844039917, 4.464297771453857, 4.474113941192627, 4.484060287475586, 4.49413537979126, 4.504341125488281, 4.514680862426758, 4.525154113769531, 4.535763740539551]

pred_pos =[2.003020982199644, -1.4614669517546799, 2.174788187572832]
currPos = [1.6418230533599854, -1.5330474376678467, 2.0655176639556885]
robotX, robotY, robotTheta = pred_pos
P = np.eye(3)
SL, SR = 0,0
[lidarTime, robotX_actual, robotY_actual, robotTheta_actual, \
    num_points, scanning_angle, start_angle, step_size, lidar_data] \
    = wall_localization.process_lidar_data(lidar_data)


robotX, robotY, robotTheta, P = wall_ekf.kalman_filter([robotX, robotY, robotTheta], lidar_data, P, SL, SR)
wall_localization.plot_actual_map()
X, Y = wall_localization.get_world_coords(robotX, robotY, robotTheta, lidar_data)
wall_localization.plot_world_coords(X, Y, 'red')

ax = plt.gca()
ax.set_aspect('equal', adjustable='box')
print('robotX', robotX)
print('robotY', robotY)
print('robotTheta', robotTheta)

print('robot X actual', currPos[0])
print('robot Y actual', currPos[1])
print('robot Theta actual', currPos[2])




